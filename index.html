<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>АСО «КОНТУР-С» | КОМАНДНЫЙ ЦЕНТР</title>
    <style>
        :root {
            --bg-dark: #050505;
            --bg-panel: #0f1218;
            --accent-red: #8e1b1b;
            --gold: #b2945e;
            --text-main: #d1d5db;
            --border: #2a2f3a;
        }

        * { box-sizing: border-box; }
        body, html { margin: 0; padding: 0; background: var(--bg-dark); color: var(--text-main); font-family: 'Segoe UI', Tahoma, sans-serif; height: 100vh; overflow: hidden; }

        .grid-bg { position: fixed; inset: 0; background-image: linear-gradient(rgba(178, 148, 94, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(178, 148, 94, 0.05) 1px, transparent 1px); background-size: 50px 50px; z-index: -1; }

        /* --- AUTH --- */
        #auth-screen { position: fixed; inset: 0; background: var(--bg-dark); z-index: 5000; display: flex; align-items: center; justify-content: center; }
        .auth-card { background: var(--bg-panel); border: 2px solid var(--gold); padding: 40px; width: 450px; text-align: center; box-shadow: 0 0 50px rgba(178, 148, 94, 0.1); }
        
        .field { width: 100%; background: #000; border: 1px solid var(--border); color: #fff; padding: 12px; margin-bottom: 10px; outline: none; font-family: 'Courier New', monospace; font-size: 0.9rem; }
        .field:focus { border-color: var(--gold); }
        
        .btn { background: var(--gold); color: #000; border: none; padding: 12px; font-weight: bold; cursor: pointer; width: 100%; text-transform: uppercase; letter-spacing: 1px; transition: 0.3s; }
        .btn:hover { background: #fff; }
        .btn-red { background: var(--accent-red); color: #fff; }

        /* --- UI LAYOUT --- */
        #app { display: grid; grid-template-columns: 260px 1fr; grid-template-rows: 60px 1fr; height: 100vh; display: none; }

        header { grid-column: 1 / 3; background: #000; border-bottom: 2px solid var(--gold); display: flex; align-items: center; padding: 0 20px; justify-content: space-between; }
        .brand { display: flex; align-items: center; gap: 10px; font-weight: bold; color: var(--gold); letter-spacing: 1px; }

        aside { background: var(--bg-panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .nav-btn { padding: 15px 20px; cursor: pointer; border-left: 3px solid transparent; color: #888; text-transform: uppercase; font-size: 0.75rem; transition: 0.2s; }
        .nav-btn:hover { background: #1a1e26; color: #fff; }
        .nav-btn.active { border-left-color: var(--gold); background: #1a1e26; color: var(--gold); font-weight: bold; }

        main { padding: 25px; overflow-y: auto; background: rgba(0,0,0,0.5); }

        /* --- CARDS & TABLES --- */
        .card { background: #161b22; border: 1px solid var(--border); padding: 25px; margin-bottom: 20px; position: relative; }
        .card h2 { margin-top: 0; color: var(--gold); font-size: 1.2rem; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
        .card h3 { color: var(--accent-red); margin-bottom: 5px; }

        .data-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        .data-table th { text-align: left; padding: 10px; background: #0a0c10; border-bottom: 2px solid var(--gold); color: #aaa; }
        .data-table td { padding: 10px; border-bottom: 1px solid #333; }
        .data-table tr:hover { background: #1f242e; }

        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        .stat-box { background: #0a0c10; padding: 15px; border: 1px solid #333; text-align: center; }
        .stat-num { font-size: 1.5rem; color: var(--gold); font-weight: bold; }

        /* MODALS */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 9999; display: none; align-items: center; justify-content: center; }
        .modal-win { background: var(--bg-panel); border: 1px solid var(--gold); padding: 30px; width: 600px; max-height: 90vh; overflow-y: auto; }
    </style>
</head>
<body>

    <div class="grid-bg"></div>

    <!-- LOGIN -->
    <div id="auth-screen">
        <div class="auth-card">
            <h2 style="color:var(--gold);">АСО «КОНТУР-С»</h2>
            <p style="font-size:0.7rem; color:#888; margin-bottom:30px;">СЛУЖЕБНЫЙ ВХОД (ЗАКРЫТЫЙ КОНТУР)</p>
            <input type="text" id="login" class="field" placeholder="ФИО СОТРУДНИКА">
            <input type="password" id="pass" class="field" placeholder="ПАРОЛЬ">
            <button class="btn" onclick="tryLogin()">ВОЙТИ В СИСТЕМУ</button>
        </div>
    </div>

    <!-- APP -->
    <div id="app">
        <header>
            <div class="brand">
                <span style="color:var(--accent-red)">☭</span> СЛЕДСТВЕННЫЙ КОМИТЕТ РФ
            </div>
            <div id="user-badge" style="font-size:0.7rem; text-align:right; color:#888;"></div>
        </header>

        <aside>
            <div class="nav-btn active" onclick="tab('profile')">ЛИЧНОЕ ДЕЛО</div>
            <div class="nav-btn" onclick="tab('staff')">ЛИЧНЫЙ СОСТАВ</div>
            <div class="nav-btn" onclick="tab('crim')">БАЗА ПРЕСТУПНИКОВ</div>
            <div class="nav-btn" onclick="tab('warehouse')">ЛОГИ СКЛАДА</div>
            <div class="nav-btn" onclick="tab('cases')">УГОЛОВНЫЕ ДЕЛА</div>
            <div class="nav-btn" id="btn-admin" style="display:none; color:var(--gold);" onclick="tab('admin')">★ АДМИНИСТРИРОВАНИЕ</div>
            <div class="nav-btn" style="margin-top:auto; color:var(--accent-red);" onclick="location.reload()">ВЫХОД</div>
        </aside>

        <main id="view"></main>
    </div>

    <!-- MODAL ADD USER -->
    <div id="m-user" class="modal-overlay">
        <div class="modal-win">
            <h3>РЕГИСТРАЦИЯ СОТРУДНИКА</h3>
            <input id="u-fio" class="field" placeholder="ФИО">
            <select id="u-rank" class="field" style="background:#000; color:#fff;">
                <option value="Генерал юстиции">Генерал юстиции</option>
                <option value="Полковник юстиции">Полковник юстиции</option>
                <option value="Подполковник юстиции">Подполковник юстиции</option>
                <option value="Майор юстиции">Майор юстиции</option>
                <option value="Капитан юстиции">Капитан юстиции</option>
                <option value="Лейтенант юстиции">Лейтенант юстиции</option>
            </select>
            <input id="u-dept" class="field" placeholder="ОТДЕЛ">
            <input id="u-pass" class="field" placeholder="ПАРОЛЬ">
            <label style="color:#888; font-size:0.8rem;">УРОВЕНЬ ДОСТУПА:</label>
            <select id="u-role" class="field" style="background:#000; color:#fff;">
                <option value="1">1 - Следователь</option>
                <option value="2">2 - Нач. Отдела</option>
                <option value="3">3 - Руководство (СК)</option>
            </select>
            <button class="btn" onclick="addUser()">ЗАРЕГИСТРИРОВАТЬ</button>
            <button class="btn btn-red" onclick="closeM()" style="margin-top:10px;">ОТМЕНА</button>
        </div>
    </div>

    <script>
        // БАЗА ДАННЫХ
        let DB = JSON.parse(localStorage.getItem('sk_v6_base')) || {
            users: [
                { fio: "Красин Александр Владимирович", rank: "Генерал юстиции", dept: "Центральный Аппарат", role: 3, pass: "Красин222", medals: "За верность долгу, За доблесть", time: "5 лет", kills: 42 }
            ],
            criminals: [
                { nick: "Bandit228", level: 15, phone: "88005553535", address: "Гентон, Дом 14", history: "Убийство (2024), Разбой (2025)", property: "Авто Infernus, Дом #14", status: "В розыске" }
            ],
            warehouse: [
                { time: "15.02.2026 10:00", user: "Иванов И.И.", item: "Патроны M4", amount: 500, action: "Взял" }
            ],
            cases: []
        };

        let Me = null;

        function save() { localStorage.setItem('sk_v6_base', JSON.stringify(DB)); }

        // LOGIN
        function tryLogin() {
            const f = document.getElementById('login').value;
            const p = document.getElementById('pass').value;
            const u = DB.users.find(x => x.fio === f && x.pass === p);
            if(u) {
                Me = u;
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('app').style.display = 'grid';
                document.getElementById('user-badge').innerHTML = `${Me.rank}<br>${Me.fio}`;
                if(Me.role >= 3) document.getElementById('btn-admin').style.display = 'block';
                tab('profile');
            } else alert("Ошибка доступа. Проверьте данные.");
        }

        // NAVIGATION
        function tab(t) {
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            event.currentTarget.classList.add('active');
            const v = document.getElementById('view');
            
            if(t === 'profile') {
                v.innerHTML = `
                    <div class="card">
                        <h2>ЛИЧНОЕ ДЕЛО СОТРУДНИКА</h2>
                        <div class="stat-grid">
                            <div style="text-align:left">
                                <h3 style="color:#fff">${Me.fio}</h3>
                                <p style="color:var(--gold)">${Me.rank}</p>
                                <p>Отдел: ${Me.dept}</p>
                                <p>Допуск: Уровень ${Me.role}</p>
                            </div>
                            <div style="text-align:right">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/ca/Emblem_of_the_Investigative_Committee_of_Russia.svg/1200px-Emblem_of_the_Investigative_Committee_of_Russia.svg.png" style="height:100px; opacity:0.5">
                            </div>
                        </div>
                        <div class="stat-grid">
                            <div class="stat-box">
                                <div style="font-size:0.7rem; color:#888;">НЕЙТРАЛИЗОВАНО</div>
                                <div class="stat-num">${Me.kills || 0}</div>
                            </div>
                            <div class="stat-box">
                                <div style="font-size:0.7rem; color:#888;">СТАЖ В ОРГАНИЗАЦИИ</div>
                                <div class="stat-num" style="font-size:1rem">${Me.time || '0 дней'}</div>
                            </div>
                        </div>
                        <br>
                        <h3>НАГРАДЫ И ЗАСЛУГИ:</h3>
                        <p style="border:1px solid #333; padding:10px;">${Me.medals || 'Нет наград'}</p>
                    </div>`;
            }
            else if(t === 'staff') {
                // Sorting logic: General > Colonel > Major...
                const ranks = {"Генерал юстиции":6, "Полковник юстиции":5, "Подполковник юстиции":4, "Майор юстиции":3, "Капитан юстиции":2, "Лейтенант юстиции":1};
                const sorted = [...DB.users].sort((a,b) => (ranks[b.rank]||0) - (ranks[a.rank]||0));
                
                let h = `<div class="card"><h2>ЛИЧНЫЙ СОСТАВ УПРАВЛЕНИЯ</h2><table class="data-table"><thead><tr><th>ЗВАНИЕ</th><th>ФИО</th><th>ОТДЕЛ</th><th>СТАТУС</th></tr></thead><tbody>`;
                sorted.forEach(u => {
                    h += `<tr>
                        <td style="color:var(--gold)">${u.rank}</td>
                        <td><b>${u.fio}</b></td>
                        <td>${u.dept}</td>
                        <td>${u.role >= 3 ? '<span style="color:red">РУКОВОДСТВО</span>' : 'Сотрудник'}</td>
                    </tr>`;
                });
                v.innerHTML = h + `</tbody></table></div>`;
            }
            else if(t === 'crim') {
                v.innerHTML = `
                    <div class="card">
                        <h2>БАЗА ДАННЫХ ПРЕСТУПНИКОВ</h2>
                        <input id="search-crim" class="field" placeholder="Введите Никнейм для поиска..." oninput="findCrim()">
                        <div id="crim-res"></div>
                    </div>
                `;
                findCrim(); // Show all initially
            }
            else if(t === 'warehouse') {
                let h = `<div class="card"><h2>ЛОГИ СКЛАДА (УЧЕТ ТМЦ)</h2>
                <div style="margin-bottom:10px; display:flex; gap:10px;">
                    <input id="w-user" class="field" placeholder="Кто взял (ФИО)" style="width:30%">
                    <input id="w-item" class="field" placeholder="Предмет">
                    <button class="btn" style="width:auto" onclick="addLog()">ДОБАВИТЬ ЗАПИСЬ</button>
                </div>
                <table class="data-table"><thead><tr><th>ВРЕМЯ</th><th>СОТРУДНИК</th><th>ПРЕДМЕТ</th><th>КОЛ-ВО</th><th>ДЕЙСТВИЕ</th></tr></thead><tbody>`;
                DB.warehouse.reverse().forEach(l => {
                    h += `<tr><td>${l.time}</td><td>${l.user}</td><td>${l.item}</td><td>${l.amount}</td><td>${l.action}</td></tr>`;
                });
                v.innerHTML = h + `</tbody></table></div>`;
            }
            else if(t === 'admin') {
                if(Me.role < 3) return alert("Доступ запрещен");
                v.innerHTML = `<div class="card"><h2>ПАНЕЛЬ УПРАВЛЕНИЯ (ADMIN)</h2>
                <p>Вы имеете доступ уровня "Руководитель СК".</p>
                <button class="btn" onclick="document.getElementById('m-user').style.display='flex'">+ ЗАРЕГИСТРИРОВАТЬ НОВОГО СОТРУДНИКА</button>
                <br><br>
                <button class="btn btn-red" onclick="downloadDB()">ВЫГРУЗИТЬ ПОЛНУЮ БАЗУ (BACKUP)</button>
                <div style="margin-top:20px"><input type="file" id="fi" onchange="uploadDB()"><br><small>Загрузить бэкап</small></div>
                </div>`;
            }
            else if(t === 'cases') {
                v.innerHTML = `<div class="card"><h2>УГОЛОВНЫЕ ДЕЛА</h2><p>Реестр доступен для просмотра.</p></div>`;
            }
        }

        // LOGIC FUNCTIONS
        function findCrim() {
            const q = document.getElementById('search-crim') ? document.getElementById('search-crim').value.toLowerCase() : '';
            const res = DB.criminals.filter(c => c.nick.toLowerCase().includes(q));
            let h = `<table class="data-table" style="margin-top:10px;"><thead><tr><th>НИКНЕЙМ</th><th>УРОВЕНЬ</th><th>ТЕЛЕФОН</th><th>ИМУЩЕСТВО</th><th>ИСТОРИЯ</th></tr></thead><tbody>`;
            if(res.length === 0) h = `<p style="padding:10px">Ничего не найдено.</p>`;
            else res.forEach(c => {
                h += `<tr>
                    <td><b>${c.nick}</b><br><small>${c.address}</small></td>
                    <td>${c.level}</td>
                    <td>${c.phone}</td>
                    <td>${c.property}</td>
                    <td style="color:#dba6a6">${c.history}</td>
                </tr>`;
            });
            if(res.length > 0) h += `</tbody></table>`;
            if(document.getElementById('crim-res')) document.getElementById('crim-res').innerHTML = h;
        }

        function addLog() {
            const u = document.getElementById('w-user').value, i = document.getElementById('w-item').value;
            if(!u || !i) return;
            DB.warehouse.push({ time: new Date().toLocaleString(), user: u, item: i, amount: "Неизв.", action: "Взял со склада" });
            save(); tab('warehouse');
        }

        function addUser() {
            const f = document.getElementById('u-fio').value, r = document.getElementById('u-rank').value, d = document.getElementById('u-dept').value,
                  p = document.getElementById('u-pass').value, ro = parseInt(document.getElementById('u-role').value);
            if(!f || !p) return alert("Заполните данные");
            DB.users.push({ fio: f, rank: r, dept: d, pass: p, role: ro, medals: "Новый сотрудник", time: "0 дней", kills: 0 });
            save(); alert("Сотрудник добавлен."); document.getElementById('m-user').style.display='none';
        }
        function closeM() { document.getElementById('m-user').style.display='none'; }

        function downloadDB() {
            const b = new Blob([JSON.stringify(DB)], {type: 'application/json'});
            const a = document.createElement('a'); a.href = URL.createObjectURL(b); a.download = 'sk_full_backup.json'; a.click();
        }
        function uploadDB() {
            const r = new FileReader();
            r.onload = e => { DB = JSON.parse(e.target.result); save(); alert("Бэкап загружен."); location.reload(); };
            r.readAsText(document.getElementById('fi').files[0]);
        }
    </script>
</body>
</html>